@model PlatDiplom.Models.PlatModel.PaymentsView

@{
    ViewBag.Title = "Payments";
}

<div class="row">

    <div class="form-group col-sm-2" style="float:left">
        @Html.DropDownList("Country", Model.FilterPlat.CountriesList as SelectList, new { @id = "Country", @class = "form-control m-3 p-3" })
        @*@Html.DropDownListFor(model=>model.FilterPlat.SelectedCountry, Model.FilterPlat.CountriesList,new { @id = "country_id", @class = "form-control" })*@
    </div>
    <div class="form-group col-sm-2" style="float:left">
        @*@Html.DropDownListFor(model => model.FilterPlat.SelectedStatus, Model.FilterPlat.StatusList, new { @id = "status_id", @class = "form-control" })*@
        @Html.DropDownList("Status", Model.FilterPlat.StatusList as SelectList, new { @id = "Status", @class = "form-control  m-3 p-3" })
    </div>
    <div class="form-group">
        <div class="col-md-4">
            <label></label>
            <br />
            <input id="btnSubmit" type="submit" />
        </div>
    </div>
</div>
<hr />

<div id="results">
    <table id="dtResult" class="table table-striped table-bordered table-hover"></table>
</div>


<div id="modDialog" class="modal fade">
    <div id="dialogContent" class="modal-dialog"></div>
</div>

<link rel="stylesheet" href="~/Content/PlatDiplom.css">
<link rel="stylesheet" href="~/Content/DataTables/css/fixedHeader.bootstrap.min.css" />


@section scripts {
    <script src="~/Scripts/DataTables/dataTables.fixedHeader.min.js"></script>
    <script src="~/Scripts/Plat.js"></script>

    <script>


		$("#btnSubmit").click(function () {
            if ($.fn.DataTable.isDataTable('#dtResult')) {
                $("#dtResult").DataTable().clear();
                $("#dtResult").DataTable().destroy();
            }
            var model = {
            };

			$("#dtResult")
				.on('processing.dt', function (e, settings, processing) {
				$('#processingIndicator').css('display', 'none');
				if (processing) {
					$("#blackDivForFullScreen").show()
				} else {
					$("#blackDivForFullScreen").hide()
				}
				})
				.DataTable({
				"searching": false,
				"serverSide": true,

				"fixedHeader": {
					headerOffset: 80
				},
				"ajax":
				{
					"url": "@Url.Action("SearchAllPAFirm", "Plat")",
					"type": "POST",
					"dataType": "JSON",
					"data": { 'filter': model }
				},
				"columnDefs": [
					{ orderable: false, targets: [1,2, 3, 4, 5,6] },
				],
                "columns": [
                    {
						"title": "Direct applicant",
						"data": "DirectApplicant", "render": function (directApplicant) {
							if (directApplicant == true)
								return '<input class="checkboxDirApp" type="checkbox" checked/>';
							else
								return '<input class="checkboxDirApp" type="checkbox"/>';
						},
						"width": "70px"
					},
					{
						"title": "ID", "data": "ID", "width": "20px"
					},
					{ "title": "P", "data": "InventionsCount", "width": "20px" },
					{ "title": "Firm name", "data": "FirmName", "width": "100px" },
					{ "title": "Address", "data": "Address", "width": "100px" },
					{ "title": "Country", "data": "CountryInEnglish", "width": "80px" },
					{
						"title": "Date WOIS",
						"data": "DateWOIS", "render": function (dateWOIS) {
							var data = "<table class='tableWoisDate'";
							data += "<tr><td class='tooltipTd'><p>"
							if (dateWOIS != null)
								data += dateWOIS;
							data += "</p><span class='tooltipImg'><img class='imgEditWoisDate' src='/Fenix/Content/img/edit.png'/></span></td>"
							data += "</tr>";
							data += "</table>";
							return data;
						},
						"width": "150px"
					}

				]
			})

        });





		$("body").on("click", ".imgSaveWoisDate", function () {
			var self = $(this);
			var editField = self.closest("tr").find("p")[0];
			var text = self.closest("tr").find("input").val();
			$.ajax({
				url: '@Url.Action("UpdateWoisDate", "AllPAFirm")',
				data: {
					idAPAF: self.closest("table").closest("tr").find("td")[0].innerHTML,
					woisDate: self.closest("tr").find("input").val()
				},
				success: function (result) {
					if (result) {
						imageEdit(self, "imgEditWoisDate");
						if (text != "") {
							var from = text.split("-");
							var newDate = from[2] + "." + from[1] + "." + from[0];
							editField.innerHTML = newDate;
						}
						else {
							editField.innerHTML = text;
						}
					}
					else {
						alert("Something went wrong");
					}
				}
			});
		});
    </script>
}




